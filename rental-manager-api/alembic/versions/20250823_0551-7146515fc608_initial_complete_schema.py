"""initial_complete_schema

Revision ID: 7146515fc608
Revises: 
Create Date: 2025-08-23 05:51:03.480180

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = '7146515fc608'
down_revision: Union[str, None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('brands',
    sa.Column('name', sa.String(length=100), nullable=False, comment='Brand name'),
    sa.Column('code', sa.String(length=20), nullable=True, comment='Unique brand code'),
    sa.Column('description', sa.Text(), nullable=True, comment='Brand description'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_brand_code_active', 'brands', ['code', 'is_active'], unique=False)
    op.create_index('idx_brand_name_active', 'brands', ['name', 'is_active'], unique=False)
    op.create_index(op.f('ix_brands_code'), 'brands', ['code'], unique=True)
    op.create_index(op.f('ix_brands_is_active'), 'brands', ['is_active'], unique=False)
    op.create_index(op.f('ix_brands_name'), 'brands', ['name'], unique=True)
    op.create_table('categories',
    sa.Column('name', sa.String(length=100), nullable=False, comment='Category name'),
    sa.Column('category_code', sa.String(length=15), nullable=False, comment='Unique category code (max 15 chars)'),
    sa.Column('parent_category_id', sa.UUID(), nullable=True, comment='Parent category ID'),
    sa.Column('category_path', sa.String(length=500), nullable=False, comment='Full category path'),
    sa.Column('category_level', sa.Integer(), nullable=False, comment='Hierarchy level'),
    sa.Column('display_order', sa.Integer(), nullable=False, comment='Display order within parent'),
    sa.Column('is_leaf', sa.Boolean(), nullable=False, comment='True if category has no children'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.ForeignKeyConstraint(['parent_category_id'], ['categories.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_category_active_leaf', 'categories', ['is_active', 'is_leaf'], unique=False)
    op.create_index('idx_category_display_order', 'categories', ['display_order'], unique=False)
    op.create_index('idx_category_level', 'categories', ['category_level'], unique=False)
    op.create_index('idx_category_parent', 'categories', ['parent_category_id'], unique=False)
    op.create_index('idx_category_parent_order', 'categories', ['parent_category_id', 'display_order'], unique=False)
    op.create_index('idx_category_path', 'categories', ['category_path'], unique=False)
    op.create_index(op.f('ix_categories_category_code'), 'categories', ['category_code'], unique=True)
    op.create_index(op.f('ix_categories_category_path'), 'categories', ['category_path'], unique=False)
    op.create_index(op.f('ix_categories_is_active'), 'categories', ['is_active'], unique=False)
    op.create_index('uk_category_name_parent', 'categories', ['name', 'parent_category_id'], unique=True)
    op.create_table('companies',
    sa.Column('company_name', sa.String(length=255), nullable=False, comment='Company name'),
    sa.Column('address', sa.Text(), nullable=True, comment='Company address'),
    sa.Column('email', sa.String(length=255), nullable=True, comment='Company email'),
    sa.Column('phone', sa.String(length=50), nullable=True, comment='Company phone number'),
    sa.Column('gst_no', sa.String(length=50), nullable=True, comment='GST registration number'),
    sa.Column('registration_number', sa.String(length=100), nullable=True, comment='Company registration number'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_company_name_active', 'companies', ['company_name', 'is_active'], unique=False)
    op.create_index(op.f('ix_companies_company_name'), 'companies', ['company_name'], unique=True)
    op.create_index(op.f('ix_companies_gst_no'), 'companies', ['gst_no'], unique=True)
    op.create_index(op.f('ix_companies_is_active'), 'companies', ['is_active'], unique=False)
    op.create_index(op.f('ix_companies_registration_number'), 'companies', ['registration_number'], unique=True)
    op.create_table('contact_persons',
    sa.Column('first_name', sa.String(length=100), nullable=False, comment='First name'),
    sa.Column('last_name', sa.String(length=100), nullable=False, comment='Last name'),
    sa.Column('full_name', sa.String(length=255), nullable=False, comment='Full name (computed)'),
    sa.Column('email', sa.String(length=100), nullable=True, comment='Primary email address'),
    sa.Column('phone', sa.String(length=20), nullable=True, comment='Primary phone number'),
    sa.Column('mobile', sa.String(length=20), nullable=True, comment='Mobile phone number'),
    sa.Column('title', sa.String(length=100), nullable=True, comment='Job title or position'),
    sa.Column('department', sa.String(length=100), nullable=True, comment='Department or division'),
    sa.Column('company', sa.String(length=255), nullable=True, comment='Company name'),
    sa.Column('address', sa.Text(), nullable=True, comment='Street address'),
    sa.Column('city', sa.String(length=100), nullable=True, comment='City'),
    sa.Column('state', sa.String(length=100), nullable=True, comment='State or province'),
    sa.Column('country', sa.String(length=100), nullable=True, comment='Country'),
    sa.Column('postal_code', sa.String(length=20), nullable=True, comment='Postal or ZIP code'),
    sa.Column('notes', sa.Text(), nullable=True, comment='Additional notes or comments'),
    sa.Column('is_primary', sa.Boolean(), nullable=True, comment='Is this the primary contact'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_contact_person_company', 'contact_persons', ['company'], unique=False)
    op.create_index('idx_contact_person_email', 'contact_persons', ['email'], unique=False)
    op.create_index('idx_contact_person_full_name', 'contact_persons', ['full_name'], unique=False)
    op.create_index('idx_contact_person_location', 'contact_persons', ['city', 'state', 'country'], unique=False)
    op.create_index('idx_contact_person_mobile', 'contact_persons', ['mobile'], unique=False)
    op.create_index('idx_contact_person_phone', 'contact_persons', ['phone'], unique=False)
    op.create_index('idx_contact_person_primary', 'contact_persons', ['is_primary'], unique=False)
    op.create_index(op.f('ix_contact_persons_is_active'), 'contact_persons', ['is_active'], unique=False)
    op.create_table('customers',
    sa.Column('customer_code', sa.String(length=50), nullable=False),
    sa.Column('customer_type', sa.String(length=20), nullable=False),
    sa.Column('business_name', sa.String(length=200), nullable=True),
    sa.Column('first_name', sa.String(length=100), nullable=False),
    sa.Column('last_name', sa.String(length=100), nullable=False),
    sa.Column('email', sa.String(length=255), nullable=False),
    sa.Column('phone', sa.String(length=20), nullable=False),
    sa.Column('mobile', sa.String(length=20), nullable=True),
    sa.Column('address_line1', sa.String(length=200), nullable=False),
    sa.Column('address_line2', sa.String(length=200), nullable=True),
    sa.Column('city', sa.String(length=100), nullable=False),
    sa.Column('state', sa.String(length=100), nullable=False),
    sa.Column('postal_code', sa.String(length=20), nullable=False),
    sa.Column('country', sa.String(length=100), nullable=False),
    sa.Column('tax_number', sa.String(length=50), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('customer_tier', sa.String(length=20), nullable=False),
    sa.Column('credit_limit', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('credit_rating', sa.String(length=20), nullable=False),
    sa.Column('payment_terms', sa.String(length=50), nullable=True),
    sa.Column('blacklist_status', sa.String(length=20), nullable=False),
    sa.Column('blacklist_reason', sa.Text(), nullable=True),
    sa.Column('blacklist_date', sa.DateTime(timezone=True), nullable=True),
    sa.Column('total_rentals', sa.Numeric(precision=10, scale=0), nullable=False),
    sa.Column('total_spent', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('lifetime_value', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('last_rental_date', sa.DateTime(timezone=True), nullable=True),
    sa.Column('last_transaction_date', sa.DateTime(timezone=True), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.CheckConstraint("blacklist_status IN ('CLEAR', 'WARNING', 'BLACKLISTED')", name='check_blacklist_status'),
    sa.CheckConstraint("credit_rating IN ('EXCELLENT', 'GOOD', 'FAIR', 'POOR', 'NO_RATING')", name='check_credit_rating'),
    sa.CheckConstraint("customer_tier IN ('BRONZE', 'SILVER', 'GOLD', 'PLATINUM')", name='check_customer_tier'),
    sa.CheckConstraint("customer_type IN ('INDIVIDUAL', 'BUSINESS')", name='check_customer_type'),
    sa.CheckConstraint("status IN ('ACTIVE', 'INACTIVE', 'SUSPENDED', 'PENDING')", name='check_customer_status'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_customer_blacklist', 'customers', ['blacklist_status'], unique=False)
    op.create_index('idx_customer_code', 'customers', ['customer_code'], unique=False)
    op.create_index('idx_customer_email', 'customers', ['email'], unique=False)
    op.create_index('idx_customer_location', 'customers', ['city', 'state', 'country'], unique=False)
    op.create_index('idx_customer_tier', 'customers', ['customer_tier'], unique=False)
    op.create_index('idx_customer_type_status', 'customers', ['customer_type', 'status'], unique=False)
    op.create_index(op.f('ix_customers_customer_code'), 'customers', ['customer_code'], unique=True)
    op.create_index(op.f('ix_customers_email'), 'customers', ['email'], unique=True)
    op.create_index(op.f('ix_customers_is_active'), 'customers', ['is_active'], unique=False)
    op.create_table('locations',
    sa.Column('location_code', sa.String(length=20), nullable=False, comment='Unique location code'),
    sa.Column('location_name', sa.String(length=100), nullable=False, comment='Location name'),
    sa.Column('location_type', sa.Enum('STORE', 'WAREHOUSE', 'SERVICE_CENTER', 'DISTRIBUTION_CENTER', 'OFFICE', name='locationtype'), nullable=False, comment='Location type'),
    sa.Column('address', sa.Text(), nullable=True, comment='Street address'),
    sa.Column('city', sa.String(length=100), nullable=True, comment='City'),
    sa.Column('state', sa.String(length=100), nullable=True, comment='State/Province'),
    sa.Column('country', sa.String(length=100), nullable=True, comment='Country'),
    sa.Column('postal_code', sa.String(length=20), nullable=True, comment='Postal/ZIP code'),
    sa.Column('contact_number', sa.String(length=30), nullable=True, comment='Phone number'),
    sa.Column('email', sa.String(length=255), nullable=True, comment='Email address'),
    sa.Column('website', sa.String(length=255), nullable=True, comment='Website URL'),
    sa.Column('latitude', sa.Numeric(precision=10, scale=8), nullable=True, comment='Latitude coordinate'),
    sa.Column('longitude', sa.Numeric(precision=11, scale=8), nullable=True, comment='Longitude coordinate'),
    sa.Column('timezone', sa.String(length=50), nullable=False, comment='Timezone identifier'),
    sa.Column('operating_hours', sa.JSON(), nullable=True, comment='Operating hours in JSON format'),
    sa.Column('capacity', sa.Integer(), nullable=True, comment='Storage/operational capacity'),
    sa.Column('is_default', sa.Boolean(), nullable=False, comment='Default location flag'),
    sa.Column('parent_location_id', sa.UUID(), nullable=True, comment='Parent location ID for hierarchy'),
    sa.Column('metadata', sa.JSON(), nullable=True, comment='Additional metadata in JSON format'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.CheckConstraint("location_type IN ('STORE', 'WAREHOUSE', 'SERVICE_CENTER', 'DISTRIBUTION_CENTER', 'OFFICE')", name='check_location_type'),
    sa.CheckConstraint('capacity >= 0', name='check_capacity_positive'),
    sa.ForeignKeyConstraint(['parent_location_id'], ['locations.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_location_active', 'locations', ['is_active'], unique=False)
    op.create_index('idx_location_city_state', 'locations', ['city', 'state'], unique=False)
    op.create_index('idx_location_code', 'locations', ['location_code'], unique=False)
    op.create_index('idx_location_coordinates', 'locations', ['latitude', 'longitude'], unique=False)
    op.create_index('idx_location_country', 'locations', ['country'], unique=False)
    op.create_index('idx_location_default', 'locations', ['is_default'], unique=False)
    op.create_index('idx_location_name', 'locations', ['location_name'], unique=False)
    op.create_index('idx_location_parent', 'locations', ['parent_location_id'], unique=False)
    op.create_index('idx_location_type', 'locations', ['location_type'], unique=False)
    op.create_index(op.f('ix_locations_city'), 'locations', ['city'], unique=False)
    op.create_index(op.f('ix_locations_country'), 'locations', ['country'], unique=False)
    op.create_index(op.f('ix_locations_is_active'), 'locations', ['is_active'], unique=False)
    op.create_index(op.f('ix_locations_location_code'), 'locations', ['location_code'], unique=True)
    op.create_index(op.f('ix_locations_location_name'), 'locations', ['location_name'], unique=False)
    op.create_index(op.f('ix_locations_location_type'), 'locations', ['location_type'], unique=False)
    op.create_index(op.f('ix_locations_parent_location_id'), 'locations', ['parent_location_id'], unique=False)
    op.create_index(op.f('ix_locations_state'), 'locations', ['state'], unique=False)
    op.create_table('suppliers',
    sa.Column('supplier_code', sa.String(length=50), nullable=False, comment='Unique supplier code'),
    sa.Column('company_name', sa.String(length=255), nullable=False, comment='Supplier company name'),
    sa.Column('supplier_type', sa.String(length=20), nullable=False, comment='Type of supplier'),
    sa.Column('contact_person', sa.String(length=255), nullable=True, comment='Primary contact person'),
    sa.Column('email', sa.String(length=255), nullable=True, comment='Supplier email address'),
    sa.Column('phone', sa.String(length=50), nullable=True, comment='Supplier phone number'),
    sa.Column('mobile', sa.String(length=50), nullable=True, comment='Supplier mobile number'),
    sa.Column('address_line1', sa.String(length=255), nullable=True, comment='Primary address line'),
    sa.Column('address_line2', sa.String(length=255), nullable=True, comment='Secondary address line'),
    sa.Column('city', sa.String(length=100), nullable=True, comment='City'),
    sa.Column('state', sa.String(length=100), nullable=True, comment='State/Province'),
    sa.Column('postal_code', sa.String(length=20), nullable=True, comment='Postal/ZIP code'),
    sa.Column('country', sa.String(length=100), nullable=True, comment='Country'),
    sa.Column('tax_id', sa.String(length=50), nullable=True, comment='Tax identification number'),
    sa.Column('payment_terms', sa.String(length=20), nullable=False, comment='Payment terms'),
    sa.Column('credit_limit', sa.Numeric(precision=12, scale=2), nullable=False, comment='Credit limit amount'),
    sa.Column('supplier_tier', sa.String(length=20), nullable=False, comment='Supplier tier'),
    sa.Column('status', sa.String(length=20), nullable=False, comment='Supplier status'),
    sa.Column('quality_rating', sa.Numeric(precision=3, scale=2), nullable=False, comment='Quality rating (0-5)'),
    sa.Column('delivery_rating', sa.Numeric(precision=3, scale=2), nullable=False, comment='Delivery rating (0-5)'),
    sa.Column('average_delivery_days', sa.Integer(), nullable=False, comment='Average delivery time in days'),
    sa.Column('total_orders', sa.Integer(), nullable=False, comment='Total number of orders'),
    sa.Column('total_spend', sa.Numeric(precision=15, scale=2), nullable=False, comment='Total amount spent'),
    sa.Column('last_order_date', sa.DateTime(), nullable=True, comment='Date of last order'),
    sa.Column('contract_start_date', sa.DateTime(), nullable=True, comment='Contract start date'),
    sa.Column('contract_end_date', sa.DateTime(), nullable=True, comment='Contract end date'),
    sa.Column('notes', sa.Text(), nullable=True, comment='Additional notes'),
    sa.Column('website', sa.String(length=255), nullable=True, comment='Supplier website'),
    sa.Column('account_manager', sa.String(length=255), nullable=True, comment='Account manager name'),
    sa.Column('preferred_payment_method', sa.String(length=50), nullable=True, comment='Preferred payment method'),
    sa.Column('insurance_expiry', sa.DateTime(), nullable=True, comment='Insurance expiry date'),
    sa.Column('certifications', sa.Text(), nullable=True, comment='Certifications held'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.CheckConstraint("payment_terms IN ('IMMEDIATE', 'NET15', 'NET30', 'NET45', 'NET60', 'NET90', 'COD')", name='check_payment_terms'),
    sa.CheckConstraint("status IN ('ACTIVE', 'INACTIVE', 'PENDING', 'APPROVED', 'SUSPENDED', 'BLACKLISTED')", name='check_supplier_status'),
    sa.CheckConstraint("supplier_tier IN ('PREMIUM', 'STANDARD', 'BASIC', 'TRIAL')", name='check_supplier_tier'),
    sa.CheckConstraint("supplier_type IN ('MANUFACTURER', 'DISTRIBUTOR', 'WHOLESALER', 'RETAILER', 'INVENTORY', 'SERVICE', 'DIRECT')", name='check_supplier_type'),
    sa.CheckConstraint('average_delivery_days >= 0', name='check_average_delivery_days'),
    sa.CheckConstraint('credit_limit >= 0', name='check_credit_limit'),
    sa.CheckConstraint('delivery_rating >= 0 AND delivery_rating <= 5', name='check_delivery_rating'),
    sa.CheckConstraint('quality_rating >= 0 AND quality_rating <= 5', name='check_quality_rating'),
    sa.CheckConstraint('total_orders >= 0', name='check_total_orders'),
    sa.CheckConstraint('total_spend >= 0', name='check_total_spend'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_supplier_code', 'suppliers', ['supplier_code'], unique=False)
    op.create_index('idx_supplier_company_name', 'suppliers', ['company_name'], unique=False)
    op.create_index('idx_supplier_contract_dates', 'suppliers', ['contract_start_date', 'contract_end_date'], unique=False)
    op.create_index('idx_supplier_email', 'suppliers', ['email'], unique=False)
    op.create_index('idx_supplier_last_order', 'suppliers', ['last_order_date'], unique=False)
    op.create_index('idx_supplier_payment_terms', 'suppliers', ['payment_terms'], unique=False)
    op.create_index('idx_supplier_ratings', 'suppliers', ['quality_rating', 'delivery_rating'], unique=False)
    op.create_index('idx_supplier_status', 'suppliers', ['status'], unique=False)
    op.create_index('idx_supplier_tier', 'suppliers', ['supplier_tier'], unique=False)
    op.create_index('idx_supplier_type', 'suppliers', ['supplier_type'], unique=False)
    op.create_index(op.f('ix_suppliers_company_name'), 'suppliers', ['company_name'], unique=False)
    op.create_index(op.f('ix_suppliers_email'), 'suppliers', ['email'], unique=False)
    op.create_index(op.f('ix_suppliers_is_active'), 'suppliers', ['is_active'], unique=False)
    op.create_index(op.f('ix_suppliers_supplier_code'), 'suppliers', ['supplier_code'], unique=True)
    op.create_table('unit_of_measurements',
    sa.Column('name', sa.String(length=50), nullable=False, comment='Unit name'),
    sa.Column('code', sa.String(length=10), nullable=True, comment='Unit code/abbreviation'),
    sa.Column('description', sa.Text(), nullable=True, comment='Unit description'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_uom_code_active', 'unit_of_measurements', ['code', 'is_active'], unique=False)
    op.create_index('idx_uom_created_at', 'unit_of_measurements', ['created_at'], unique=False)
    op.create_index('idx_uom_name_active', 'unit_of_measurements', ['name', 'is_active'], unique=False)
    op.create_index(op.f('ix_unit_of_measurements_code'), 'unit_of_measurements', ['code'], unique=True)
    op.create_index(op.f('ix_unit_of_measurements_is_active'), 'unit_of_measurements', ['is_active'], unique=False)
    op.create_index(op.f('ix_unit_of_measurements_name'), 'unit_of_measurements', ['name'], unique=True)
    op.create_table('users',
    sa.Column('email', sa.String(length=255), nullable=False),
    sa.Column('username', sa.String(length=50), nullable=False),
    sa.Column('hashed_password', sa.String(length=255), nullable=False),
    sa.Column('first_name', sa.String(length=100), nullable=False),
    sa.Column('last_name', sa.String(length=100), nullable=False),
    sa.Column('phone', sa.String(length=20), nullable=True),
    sa.Column('role', sa.String(length=20), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('is_verified', sa.Boolean(), nullable=False),
    sa.Column('is_superuser', sa.Boolean(), nullable=False),
    sa.Column('last_login', sa.DateTime(), nullable=True),
    sa.Column('email_verified_at', sa.DateTime(), nullable=True),
    sa.Column('password_changed_at', sa.DateTime(), nullable=True),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.CheckConstraint("role IN ('admin', 'landlord', 'tenant', 'maintenance', 'viewer')", name='check_user_role'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_users_email'), 'users', ['email'], unique=True)
    op.create_index(op.f('ix_users_username'), 'users', ['username'], unique=True)
    op.create_table('items',
    sa.Column('item_name', sa.String(length=255), nullable=False, comment='Name of the item'),
    sa.Column('sku', sa.String(length=50), nullable=False, comment='Stock Keeping Unit (auto-generated)'),
    sa.Column('description', sa.Text(), nullable=True, comment='Detailed description of the item'),
    sa.Column('short_description', sa.String(length=500), nullable=True, comment='Brief description for listings'),
    sa.Column('brand_id', sa.UUID(), nullable=True, comment='Brand ID'),
    sa.Column('category_id', sa.UUID(), nullable=True, comment='Category ID'),
    sa.Column('unit_of_measurement_id', sa.UUID(), nullable=True, comment='Unit of measurement ID'),
    sa.Column('weight', sa.Numeric(precision=10, scale=3), nullable=True, comment='Weight in kg'),
    sa.Column('dimensions_length', sa.Numeric(precision=10, scale=2), nullable=True, comment='Length in cm'),
    sa.Column('dimensions_width', sa.Numeric(precision=10, scale=2), nullable=True, comment='Width in cm'),
    sa.Column('dimensions_height', sa.Numeric(precision=10, scale=2), nullable=True, comment='Height in cm'),
    sa.Column('color', sa.String(length=50), nullable=True, comment='Item color'),
    sa.Column('material', sa.String(length=100), nullable=True, comment='Material composition'),
    sa.Column('is_rentable', sa.Boolean(), nullable=False, comment='Whether item can be rented'),
    sa.Column('is_salable', sa.Boolean(), nullable=False, comment='Whether item can be sold'),
    sa.Column('requires_serial_number', sa.Boolean(), nullable=False, comment='Whether serial numbers are required'),
    sa.Column('cost_price', sa.Numeric(precision=15, scale=2), nullable=True, comment='Cost to acquire the item'),
    sa.Column('sale_price', sa.Numeric(precision=15, scale=2), nullable=True, comment='Selling price'),
    sa.Column('rental_rate_per_day', sa.Numeric(precision=15, scale=2), nullable=True, comment='Daily rental rate'),
    sa.Column('security_deposit', sa.Numeric(precision=15, scale=2), nullable=True, comment='Required deposit for rentals'),
    sa.Column('is_rental_blocked', sa.Boolean(), nullable=False, comment='Whether rental is currently blocked'),
    sa.Column('rental_block_reason', sa.String(length=500), nullable=True, comment='Reason for blocking rental'),
    sa.Column('rental_blocked_at', sa.DateTime(timezone=True), nullable=True, comment='When rental was blocked'),
    sa.Column('rental_blocked_by', sa.UUID(), nullable=True, comment='UUID of user who blocked rental'),
    sa.Column('reorder_level', sa.Integer(), nullable=True, comment='Minimum stock level before reordering'),
    sa.Column('maximum_stock_level', sa.Integer(), nullable=True, comment='Maximum stock level'),
    sa.Column('status', sa.String(length=50), nullable=False, comment='Current item status'),
    sa.Column('notes', sa.Text(), nullable=True, comment='Additional notes about the item'),
    sa.Column('tags', sa.String(length=1000), nullable=True, comment='Comma-separated tags for search'),
    sa.Column('last_maintenance_date', sa.DateTime(timezone=True), nullable=True, comment='Last maintenance performed'),
    sa.Column('warranty_expiry_date', sa.DateTime(timezone=True), nullable=True, comment='Warranty expiration date'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.ForeignKeyConstraint(['brand_id'], ['brands.id'], ),
    sa.ForeignKeyConstraint(['category_id'], ['categories.id'], ),
    sa.ForeignKeyConstraint(['unit_of_measurement_id'], ['unit_of_measurements.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_item_brand_active', 'items', ['brand_id', 'is_active'], unique=False)
    op.create_index('idx_item_brand_salable', 'items', ['brand_id', 'is_salable', 'is_active'], unique=False)
    op.create_index('idx_item_category_active', 'items', ['category_id', 'is_active'], unique=False)
    op.create_index('idx_item_category_rentable', 'items', ['category_id', 'is_rentable', 'is_active'], unique=False)
    op.create_index('idx_item_name_active', 'items', ['item_name', 'is_active'], unique=False)
    op.create_index('idx_item_rentable_active', 'items', ['is_rentable', 'is_active'], unique=False)
    op.create_index('idx_item_rental_blocked', 'items', ['is_rental_blocked', 'is_active'], unique=False)
    op.create_index('idx_item_rental_rate', 'items', ['rental_rate_per_day'], unique=False)
    op.create_index('idx_item_salable_active', 'items', ['is_salable', 'is_active'], unique=False)
    op.create_index('idx_item_sale_price', 'items', ['sale_price'], unique=False)
    op.create_index('idx_item_search_text', 'items', ['item_name', 'short_description'], unique=False)
    op.create_index('idx_item_sku_active', 'items', ['sku', 'is_active'], unique=False)
    op.create_index('idx_item_status_active', 'items', ['status', 'is_active'], unique=False)
    op.create_index('idx_item_unit_active', 'items', ['unit_of_measurement_id', 'is_active'], unique=False)
    op.create_index(op.f('ix_items_brand_id'), 'items', ['brand_id'], unique=False)
    op.create_index(op.f('ix_items_category_id'), 'items', ['category_id'], unique=False)
    op.create_index(op.f('ix_items_is_active'), 'items', ['is_active'], unique=False)
    op.create_index(op.f('ix_items_is_rentable'), 'items', ['is_rentable'], unique=False)
    op.create_index(op.f('ix_items_is_rental_blocked'), 'items', ['is_rental_blocked'], unique=False)
    op.create_index(op.f('ix_items_is_salable'), 'items', ['is_salable'], unique=False)
    op.create_index(op.f('ix_items_item_name'), 'items', ['item_name'], unique=False)
    op.create_index(op.f('ix_items_sku'), 'items', ['sku'], unique=True)
    op.create_index(op.f('ix_items_status'), 'items', ['status'], unique=False)
    op.create_index(op.f('ix_items_unit_of_measurement_id'), 'items', ['unit_of_measurement_id'], unique=False)
    op.create_table('sku_sequences',
    sa.Column('brand_id', sa.UUID(), nullable=True, comment='Brand for this sequence (optional)'),
    sa.Column('category_id', sa.UUID(), nullable=True, comment='Category for this sequence (optional)'),
    sa.Column('prefix', sa.String(length=20), nullable=True, comment='Prefix for generated SKUs'),
    sa.Column('suffix', sa.String(length=20), nullable=True, comment='Suffix for generated SKUs'),
    sa.Column('next_sequence', sa.Integer(), nullable=False, comment='Next sequence number to use'),
    sa.Column('padding_length', sa.Integer(), nullable=False, comment='Number of digits to pad sequence to'),
    sa.Column('format_template', sa.String(length=100), nullable=True, comment='Python format string for SKU generation'),
    sa.Column('last_generated_sku', sa.String(length=50), nullable=True, comment='Last SKU generated from this sequence'),
    sa.Column('last_generated_at', sa.DateTime(timezone=True), nullable=True, comment='When the last SKU was generated'),
    sa.Column('total_generated', sa.Integer(), nullable=False, comment='Total SKUs generated from this sequence'),
    sa.Column('is_active', sa.Boolean(), nullable=False, comment='Whether this sequence is active'),
    sa.Column('description', sa.String(length=200), nullable=True, comment='Description of this sequence'),
    sa.Column('version', sa.Integer(), nullable=False, comment='Version for optimistic locking'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.CheckConstraint('next_sequence > 0', name='check_next_sequence_positive'),
    sa.CheckConstraint('padding_length >= 0 AND padding_length <= 10', name='check_padding_length_range'),
    sa.CheckConstraint('total_generated >= 0', name='check_total_generated_non_negative'),
    sa.ForeignKeyConstraint(['brand_id'], ['brands.id'], name='fk_sku_sequence_brand'),
    sa.ForeignKeyConstraint(['category_id'], ['categories.id'], name='fk_sku_sequence_category'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('brand_id', 'category_id', name='uq_sku_sequence_brand_category')
    )
    op.create_index('idx_sku_sequence_active', 'sku_sequences', ['is_active'], unique=False)
    op.create_index('idx_sku_sequence_brand', 'sku_sequences', ['brand_id'], unique=False)
    op.create_index('idx_sku_sequence_category', 'sku_sequences', ['category_id'], unique=False)
    op.create_index('idx_sku_sequence_next', 'sku_sequences', ['next_sequence'], unique=False)
    op.create_table('transaction_headers',
    sa.Column('transaction_number', sa.String(length=50), nullable=False, comment='Human-readable transaction number'),
    sa.Column('transaction_type', sa.Enum('SALE', 'PURCHASE', 'RENTAL', 'RETURN', 'ADJUSTMENT', name='transactiontype'), nullable=False, comment='Type of transaction'),
    sa.Column('status', sa.Enum('PENDING', 'PROCESSING', 'COMPLETED', 'CANCELLED', 'ON_HOLD', 'IN_PROGRESS', name='transactionstatus'), nullable=False, comment='Current status'),
    sa.Column('transaction_date', sa.DateTime(timezone=True), nullable=False, comment='Transaction date and time'),
    sa.Column('due_date', sa.Date(), nullable=True, comment='Payment due date'),
    sa.Column('customer_id', sa.UUID(), nullable=True, comment='Customer UUID'),
    sa.Column('supplier_id', sa.UUID(), nullable=True, comment='Supplier UUID'),
    sa.Column('location_id', sa.UUID(), nullable=True, comment='Location UUID'),
    sa.Column('sales_person_id', sa.UUID(), nullable=True, comment='Sales person handling transaction'),
    sa.Column('currency', sa.String(length=3), nullable=False, comment='Currency code'),
    sa.Column('subtotal', sa.Numeric(precision=15, scale=2), nullable=False, comment='Subtotal before discounts and taxes'),
    sa.Column('discount_amount', sa.Numeric(precision=15, scale=2), nullable=False, comment='Total discount amount'),
    sa.Column('tax_amount', sa.Numeric(precision=15, scale=2), nullable=False, comment='Total tax amount'),
    sa.Column('shipping_amount', sa.Numeric(precision=15, scale=2), nullable=False, comment='Shipping charges'),
    sa.Column('total_amount', sa.Numeric(precision=15, scale=2), nullable=False, comment='Final total amount'),
    sa.Column('paid_amount', sa.Numeric(precision=15, scale=2), nullable=False, comment='Amount already paid'),
    sa.Column('payment_status', sa.Enum('PENDING', 'PAID', 'PARTIAL', 'FAILED', 'REFUNDED', name='paymentstatus'), nullable=True, comment='Payment status'),
    sa.Column('deposit_amount', sa.Numeric(precision=15, scale=2), nullable=True, comment='Security deposit for rentals'),
    sa.Column('deposit_paid', sa.Boolean(), nullable=False, comment='Whether deposit has been paid'),
    sa.Column('customer_advance_balance', sa.Numeric(precision=15, scale=2), nullable=False, comment='Customer advance payment balance'),
    sa.Column('reference_transaction_id', sa.UUID(), nullable=True, comment='Reference to original transaction for returns'),
    sa.Column('notes', sa.Text(), nullable=True, comment='Additional notes'),
    sa.Column('reference_number', sa.String(length=50), nullable=True, comment='External reference number'),
    sa.Column('payment_method', sa.Enum('CASH', 'CREDIT_CARD', 'DEBIT_CARD', 'BANK_TRANSFER', 'CHEQUE', 'ONLINE', 'CREDIT_ACCOUNT', name='paymentmethod'), nullable=True, comment='Payment method'),
    sa.Column('payment_reference', sa.String(length=100), nullable=True, comment='Payment reference'),
    sa.Column('return_workflow_state', sa.String(length=50), nullable=True, comment='Return workflow state'),
    sa.Column('delivery_required', sa.Boolean(), nullable=False, comment='Whether delivery is required'),
    sa.Column('delivery_address', sa.Text(), nullable=True, comment='Delivery address if delivery is required'),
    sa.Column('delivery_date', sa.Date(), nullable=True, comment='Scheduled delivery date'),
    sa.Column('delivery_time', sa.Time(), nullable=True, comment='Scheduled delivery time'),
    sa.Column('pickup_required', sa.Boolean(), nullable=False, comment='Whether pickup is required'),
    sa.Column('pickup_date', sa.Date(), nullable=True, comment='Scheduled pickup date'),
    sa.Column('pickup_time', sa.Time(), nullable=True, comment='Scheduled pickup time'),
    sa.Column('extension_count', sa.Integer(), nullable=False, comment='Number of times this rental has been extended'),
    sa.Column('total_extension_charges', sa.Numeric(precision=15, scale=2), nullable=False, comment='Total accumulated extension charges'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.CheckConstraint('paid_amount <= total_amount', name='check_paid_not_exceed_total'),
    sa.CheckConstraint('paid_amount >= 0', name='check_positive_paid'),
    sa.CheckConstraint('total_amount >= 0', name='check_positive_total'),
    sa.ForeignKeyConstraint(['customer_id'], ['customers.id'], name='fk_transaction_header_customer'),
    sa.ForeignKeyConstraint(['location_id'], ['locations.id'], name='fk_transaction_header_location'),
    sa.ForeignKeyConstraint(['reference_transaction_id'], ['transaction_headers.id'], name='fk_transaction_header_reference'),
    sa.ForeignKeyConstraint(['supplier_id'], ['suppliers.id'], name='fk_transaction_header_supplier'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('transaction_number')
    )
    op.create_index('idx_customer_id', 'transaction_headers', ['customer_id'], unique=False)
    op.create_index('idx_delivery_date', 'transaction_headers', ['delivery_date'], unique=False)
    op.create_index('idx_location_id', 'transaction_headers', ['location_id'], unique=False)
    op.create_index('idx_pickup_date', 'transaction_headers', ['pickup_date'], unique=False)
    op.create_index('idx_reference_transaction', 'transaction_headers', ['reference_transaction_id'], unique=False)
    op.create_index('idx_supplier_id', 'transaction_headers', ['supplier_id'], unique=False)
    op.create_index('idx_transaction_date', 'transaction_headers', ['transaction_date'], unique=False)
    op.create_index('idx_transaction_number', 'transaction_headers', ['transaction_number'], unique=False)
    op.create_index('idx_transaction_status', 'transaction_headers', ['status'], unique=False)
    op.create_index('idx_transaction_type', 'transaction_headers', ['transaction_type'], unique=False)
    op.create_index(op.f('ix_transaction_headers_is_active'), 'transaction_headers', ['is_active'], unique=False)
    op.create_table('inventory_units',
    sa.Column('item_id', sa.UUID(), nullable=False, comment='Parent item this unit belongs to'),
    sa.Column('location_id', sa.UUID(), nullable=False, comment='Current location of this unit'),
    sa.Column('sku', sa.String(length=50), nullable=False, comment='Unique SKU for this unit'),
    sa.Column('serial_number', sa.String(length=100), nullable=True, comment='Serial number for serialized items'),
    sa.Column('batch_code', sa.String(length=50), nullable=True, comment='Batch code for non-serialized items'),
    sa.Column('barcode', sa.String(length=100), nullable=True, comment='Barcode for scanning'),
    sa.Column('status', sa.String(length=20), nullable=False, comment='Current status of the unit'),
    sa.Column('condition', sa.String(length=20), nullable=False, comment='Physical condition of the unit'),
    sa.Column('quantity', sa.Numeric(precision=10, scale=2), nullable=False, comment='Quantity in this unit/batch'),
    sa.Column('purchase_date', sa.DateTime(timezone=True), nullable=True, comment='When this unit was purchased'),
    sa.Column('purchase_price', sa.Numeric(precision=10, scale=2), nullable=False, comment='Purchase price per unit'),
    sa.Column('supplier_id', sa.UUID(), nullable=True, comment='Supplier this unit was purchased from'),
    sa.Column('purchase_order_number', sa.String(length=100), nullable=True, comment='PO number for this purchase'),
    sa.Column('sale_price', sa.Numeric(precision=10, scale=2), nullable=True, comment='Sale price per unit'),
    sa.Column('rental_rate_per_period', sa.Numeric(precision=10, scale=2), nullable=True, comment='Rental rate per period'),
    sa.Column('rental_period', sa.Integer(), nullable=False, comment='Rental period in days'),
    sa.Column('security_deposit', sa.Numeric(precision=10, scale=2), nullable=False, comment='Security deposit per unit'),
    sa.Column('model_number', sa.String(length=100), nullable=True, comment='Model number'),
    sa.Column('manufacturer', sa.String(length=100), nullable=True, comment='Manufacturer name'),
    sa.Column('color', sa.String(length=50), nullable=True, comment='Color variant'),
    sa.Column('size', sa.String(length=50), nullable=True, comment='Size variant'),
    sa.Column('warranty_expiry', sa.DateTime(timezone=True), nullable=True, comment='Warranty expiration date'),
    sa.Column('warranty_provider', sa.String(length=100), nullable=True, comment='Warranty provider'),
    sa.Column('warranty_terms', sa.Text(), nullable=True, comment='Warranty terms and conditions'),
    sa.Column('last_maintenance_date', sa.DateTime(timezone=True), nullable=True, comment='Last maintenance performed'),
    sa.Column('next_maintenance_date', sa.DateTime(timezone=True), nullable=True, comment='Next scheduled maintenance'),
    sa.Column('maintenance_history', sa.Text(), nullable=True, comment='JSON history of maintenance'),
    sa.Column('total_rental_hours', sa.Numeric(precision=10, scale=2), nullable=False, comment='Total hours/days rented'),
    sa.Column('total_rental_count', sa.Integer(), nullable=False, comment='Number of times rented'),
    sa.Column('is_rental_blocked', sa.Boolean(), nullable=False, comment='Unit blocked from rental'),
    sa.Column('rental_block_reason', sa.Text(), nullable=True, comment='Reason for blocking rental'),
    sa.Column('rental_blocked_at', sa.DateTime(timezone=True), nullable=True, comment='When rental was blocked'),
    sa.Column('rental_blocked_by_id', sa.UUID(), nullable=True, comment='User who blocked rental'),
    sa.Column('original_location_id', sa.UUID(), nullable=True, comment='Original/home location'),
    sa.Column('current_holder_id', sa.UUID(), nullable=True, comment='Current customer holding this unit'),
    sa.Column('notes', sa.Text(), nullable=True, comment='General notes about this unit'),
    sa.Column('custom_fields', sa.Text(), nullable=True, comment='JSON for custom fields'),
    sa.Column('version', sa.Integer(), nullable=False, comment='Version for optimistic locking'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.CheckConstraint("NOT (serial_number IS NOT NULL AND batch_code IS NOT NULL AND serial_number != '')", name='check_not_both_serial_and_batch'),
    sa.CheckConstraint('(serial_number IS NOT NULL) OR (batch_code IS NOT NULL)', name='check_serial_or_batch'),
    sa.CheckConstraint('purchase_price >= 0', name='check_purchase_price_non_negative'),
    sa.CheckConstraint('quantity > 0', name='check_quantity_positive'),
    sa.CheckConstraint('rental_period > 0', name='check_rental_period_positive'),
    sa.CheckConstraint('rental_rate_per_period IS NULL OR rental_rate_per_period >= 0', name='check_rental_rate_non_negative'),
    sa.CheckConstraint('sale_price IS NULL OR sale_price >= 0', name='check_sale_price_non_negative'),
    sa.CheckConstraint('security_deposit >= 0', name='check_security_deposit_non_negative'),
    sa.ForeignKeyConstraint(['current_holder_id'], ['customers.id'], name='fk_inventory_unit_current_holder'),
    sa.ForeignKeyConstraint(['item_id'], ['items.id'], name='fk_inventory_unit_item'),
    sa.ForeignKeyConstraint(['location_id'], ['locations.id'], name='fk_inventory_unit_location'),
    sa.ForeignKeyConstraint(['original_location_id'], ['locations.id'], name='fk_inventory_unit_original_location'),
    sa.ForeignKeyConstraint(['rental_blocked_by_id'], ['users.id'], name='fk_inventory_unit_blocked_by'),
    sa.ForeignKeyConstraint(['supplier_id'], ['suppliers.id'], name='fk_inventory_unit_supplier'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_inventory_unit_available', 'inventory_units', ['item_id', 'location_id', 'status'], unique=False)
    op.create_index('idx_inventory_unit_batch', 'inventory_units', ['batch_code'], unique=False)
    op.create_index('idx_inventory_unit_condition', 'inventory_units', ['condition'], unique=False)
    op.create_index('idx_inventory_unit_item', 'inventory_units', ['item_id'], unique=False)
    op.create_index('idx_inventory_unit_location', 'inventory_units', ['location_id'], unique=False)
    op.create_index('idx_inventory_unit_rental_blocked', 'inventory_units', ['is_rental_blocked'], unique=False)
    op.create_index('idx_inventory_unit_status', 'inventory_units', ['status'], unique=False)
    op.create_index(op.f('ix_inventory_units_barcode'), 'inventory_units', ['barcode'], unique=True)
    op.create_index(op.f('ix_inventory_units_batch_code'), 'inventory_units', ['batch_code'], unique=False)
    op.create_index(op.f('ix_inventory_units_is_active'), 'inventory_units', ['is_active'], unique=False)
    op.create_index(op.f('ix_inventory_units_serial_number'), 'inventory_units', ['serial_number'], unique=True)
    op.create_index(op.f('ix_inventory_units_sku'), 'inventory_units', ['sku'], unique=True)
    op.create_table('rental_lifecycles',
    sa.Column('transaction_id', sa.UUID(), nullable=False, comment='Associated transaction'),
    sa.Column('current_status', sa.String(length=30), nullable=False, comment='Current rental status'),
    sa.Column('last_status_change', sa.DateTime(timezone=True), nullable=False, comment='Last status change timestamp'),
    sa.Column('status_changed_by', sa.UUID(), nullable=True, comment='User who changed status'),
    sa.Column('total_returned_quantity', sa.Numeric(precision=10, scale=2), nullable=False, comment='Total quantity returned across all events'),
    sa.Column('expected_return_date', sa.Date(), nullable=True, comment='Expected return date (may change with extensions)'),
    sa.Column('total_late_fees', sa.Numeric(precision=15, scale=2), nullable=False, comment='Accumulated late fees'),
    sa.Column('total_damage_fees', sa.Numeric(precision=15, scale=2), nullable=False, comment='Accumulated damage fees'),
    sa.Column('total_other_fees', sa.Numeric(precision=15, scale=2), nullable=False, comment='Other fees (cleaning, restocking, etc.)'),
    sa.Column('notes', sa.Text(), nullable=True, comment='General notes about the rental'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.ForeignKeyConstraint(['transaction_id'], ['transaction_headers.id'], name='fk_rental_lifecycle_transaction'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('transaction_id')
    )
    op.create_index('idx_lifecycle_expected_return', 'rental_lifecycles', ['expected_return_date'], unique=False)
    op.create_index('idx_lifecycle_status', 'rental_lifecycles', ['current_status'], unique=False)
    op.create_index('idx_lifecycle_transaction', 'rental_lifecycles', ['transaction_id'], unique=False)
    op.create_index(op.f('ix_rental_lifecycles_is_active'), 'rental_lifecycles', ['is_active'], unique=False)
    op.create_table('stock_levels',
    sa.Column('item_id', sa.UUID(), nullable=False, comment='Item being tracked'),
    sa.Column('location_id', sa.UUID(), nullable=False, comment='Location where stock is held'),
    sa.Column('quantity_on_hand', sa.Numeric(precision=10, scale=2), nullable=False, comment='Total physical quantity at location'),
    sa.Column('quantity_available', sa.Numeric(precision=10, scale=2), nullable=False, comment='Quantity available for rental/sale'),
    sa.Column('quantity_reserved', sa.Numeric(precision=10, scale=2), nullable=False, comment='Quantity reserved for pending transactions'),
    sa.Column('quantity_on_rent', sa.Numeric(precision=10, scale=2), nullable=False, comment='Quantity currently rented out'),
    sa.Column('quantity_damaged', sa.Numeric(precision=10, scale=2), nullable=False, comment='Quantity damaged but still in inventory'),
    sa.Column('quantity_under_repair', sa.Numeric(precision=10, scale=2), nullable=False, comment='Quantity being repaired'),
    sa.Column('quantity_beyond_repair', sa.Numeric(precision=10, scale=2), nullable=False, comment='Quantity beyond repair awaiting write-off'),
    sa.Column('reorder_point', sa.Numeric(precision=10, scale=2), nullable=True, comment='Quantity at which to reorder'),
    sa.Column('reorder_quantity', sa.Numeric(precision=10, scale=2), nullable=True, comment='Quantity to order when reordering'),
    sa.Column('maximum_stock', sa.Numeric(precision=10, scale=2), nullable=True, comment='Maximum stock level to maintain'),
    sa.Column('average_cost', sa.Numeric(precision=10, scale=2), nullable=True, comment='Average cost per unit for valuation'),
    sa.Column('last_purchase_cost', sa.Numeric(precision=10, scale=2), nullable=True, comment='Cost from last purchase'),
    sa.Column('total_value', sa.Numeric(precision=12, scale=2), nullable=True, comment='Total inventory value at this location'),
    sa.Column('last_counted_date', sa.DateTime(timezone=True), nullable=True, comment='Last physical count date'),
    sa.Column('last_movement_date', sa.DateTime(timezone=True), nullable=True, comment='Last stock movement date'),
    sa.Column('last_reorder_date', sa.DateTime(timezone=True), nullable=True, comment='Last reorder date'),
    sa.Column('stock_status', sa.String(length=20), nullable=False, comment='Cached stock status for quick filtering'),
    sa.Column('version', sa.Integer(), nullable=False, comment='Version number for optimistic locking'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.CheckConstraint('abs((quantity_available + quantity_reserved + quantity_on_rent + quantity_damaged + quantity_under_repair + quantity_beyond_repair) - quantity_on_hand) < 0.01', name='check_quantity_allocation'),
    sa.CheckConstraint('quantity_available >= 0', name='check_quantity_available_non_negative'),
    sa.CheckConstraint('quantity_beyond_repair >= 0', name='check_quantity_beyond_repair_non_negative'),
    sa.CheckConstraint('quantity_damaged >= 0', name='check_quantity_damaged_non_negative'),
    sa.CheckConstraint('quantity_on_hand >= 0', name='check_quantity_on_hand_non_negative'),
    sa.CheckConstraint('quantity_on_rent >= 0', name='check_quantity_on_rent_non_negative'),
    sa.CheckConstraint('quantity_reserved >= 0', name='check_quantity_reserved_non_negative'),
    sa.CheckConstraint('quantity_under_repair >= 0', name='check_quantity_under_repair_non_negative'),
    sa.ForeignKeyConstraint(['item_id'], ['items.id'], name='fk_stock_level_item'),
    sa.ForeignKeyConstraint(['location_id'], ['locations.id'], name='fk_stock_level_location'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('item_id', 'location_id', name='uq_stock_level_item_location')
    )
    op.create_index('idx_stock_level_available', 'stock_levels', ['quantity_available'], unique=False)
    op.create_index('idx_stock_level_item', 'stock_levels', ['item_id'], unique=False)
    op.create_index('idx_stock_level_location', 'stock_levels', ['location_id'], unique=False)
    op.create_index('idx_stock_level_low_stock', 'stock_levels', ['quantity_available', 'reorder_point'], unique=False)
    op.create_index('idx_stock_level_status', 'stock_levels', ['stock_status'], unique=False)
    op.create_index(op.f('ix_stock_levels_is_active'), 'stock_levels', ['is_active'], unique=False)
    op.create_table('transaction_events',
    sa.Column('transaction_id', sa.UUID(), nullable=False, comment='Transaction this event belongs to'),
    sa.Column('event_type', sa.String(length=50), nullable=False, comment='Type of event (CREATED, VALIDATED, PROCESSED, etc.)'),
    sa.Column('event_category', sa.String(length=30), nullable=False, comment='Event category (TRANSACTION, INVENTORY, PAYMENT, ERROR, etc.)'),
    sa.Column('description', sa.Text(), nullable=False, comment='Human-readable description of the event'),
    sa.Column('event_data', sa.JSON(), nullable=True, comment='Additional structured data related to the event'),
    sa.Column('user_id', sa.UUID(), nullable=True, comment='User who triggered this event'),
    sa.Column('session_id', sa.String(length=100), nullable=True, comment='Session identifier for tracking user sessions'),
    sa.Column('ip_address', sa.String(length=45), nullable=True, comment='IP address of the client (supports IPv6)'),
    sa.Column('user_agent', sa.String(length=500), nullable=True, comment='User agent string from the request'),
    sa.Column('service_name', sa.String(length=50), nullable=True, comment='Name of the service that generated this event'),
    sa.Column('operation_name', sa.String(length=100), nullable=True, comment='Specific operation being performed'),
    sa.Column('correlation_id', sa.String(length=100), nullable=True, comment='Correlation ID for tracking across services'),
    sa.Column('event_timestamp', sa.DateTime(timezone=True), nullable=False, comment='When this event occurred'),
    sa.Column('processing_duration_ms', sa.String(length=20), nullable=True, comment='How long the operation took in milliseconds'),
    sa.Column('status', sa.String(length=20), nullable=False, comment='Event status (SUCCESS, FAILURE, WARNING, INFO)'),
    sa.Column('error_code', sa.String(length=50), nullable=True, comment='Error code if the event represents an error'),
    sa.Column('error_message', sa.Text(), nullable=True, comment='Error message if the event represents an error'),
    sa.Column('affected_entities', sa.JSON(), nullable=True, comment='List of entities affected by this event'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.ForeignKeyConstraint(['transaction_id'], ['transaction_headers.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_transaction_events_category', 'transaction_events', ['event_category'], unique=False)
    op.create_index('idx_transaction_events_category_status', 'transaction_events', ['event_category', 'status', 'event_timestamp'], unique=False)
    op.create_index('idx_transaction_events_correlation', 'transaction_events', ['correlation_id'], unique=False)
    op.create_index('idx_transaction_events_event_type', 'transaction_events', ['event_type'], unique=False)
    op.create_index('idx_transaction_events_operation', 'transaction_events', ['operation_name'], unique=False)
    op.create_index('idx_transaction_events_status', 'transaction_events', ['status'], unique=False)
    op.create_index('idx_transaction_events_timestamp', 'transaction_events', ['event_timestamp'], unique=False)
    op.create_index('idx_transaction_events_transaction_id', 'transaction_events', ['transaction_id'], unique=False)
    op.create_index('idx_transaction_events_tx_type_time', 'transaction_events', ['transaction_id', 'event_type', 'event_timestamp'], unique=False)
    op.create_index('idx_transaction_events_user_id', 'transaction_events', ['user_id'], unique=False)
    op.create_index(op.f('ix_transaction_events_is_active'), 'transaction_events', ['is_active'], unique=False)
    op.create_table('transaction_lines',
    sa.Column('transaction_header_id', sa.UUID(), nullable=False, comment='Parent transaction ID'),
    sa.Column('line_number', sa.Integer(), nullable=False, comment='Line sequence number within transaction'),
    sa.Column('line_type', sa.Enum('PRODUCT', 'SERVICE', 'DISCOUNT', 'TAX', 'SHIPPING', 'FEE', name='lineitemtype'), nullable=False, comment='Type of line item'),
    sa.Column('item_id', sa.UUID(), nullable=True, comment='Item/Product UUID'),
    sa.Column('inventory_unit_id', sa.UUID(), nullable=True, comment='Specific inventory unit for serialized items'),
    sa.Column('sku', sa.String(length=100), nullable=True, comment='Stock Keeping Unit'),
    sa.Column('description', sa.Text(), nullable=False, comment='Line item description'),
    sa.Column('category', sa.String(length=100), nullable=True, comment='Item category'),
    sa.Column('quantity', sa.Numeric(precision=10, scale=2), nullable=False, comment='Quantity ordered/sold'),
    sa.Column('unit_of_measure', sa.String(length=20), nullable=True, comment='Unit of measurement'),
    sa.Column('unit_price', sa.Numeric(precision=10, scale=2), nullable=False, comment='Price per unit'),
    sa.Column('total_price', sa.Numeric(precision=10, scale=2), nullable=False, comment='Total price before tax/discount'),
    sa.Column('discount_percent', sa.Numeric(precision=5, scale=2), nullable=False, comment='Discount percentage'),
    sa.Column('discount_amount', sa.Numeric(precision=10, scale=2), nullable=False, comment='Discount amount'),
    sa.Column('tax_rate', sa.Numeric(precision=5, scale=2), nullable=False, comment='Tax rate percentage'),
    sa.Column('tax_amount', sa.Numeric(precision=10, scale=2), nullable=False, comment='Tax amount'),
    sa.Column('line_total', sa.Numeric(precision=10, scale=2), nullable=False, comment='Total for this line item'),
    sa.Column('rental_start_date', sa.Date(), nullable=True, comment='Item rental start date'),
    sa.Column('rental_end_date', sa.Date(), nullable=True, comment='Item rental end date'),
    sa.Column('rental_period', sa.Integer(), nullable=True, comment='Rental period for this item'),
    sa.Column('rental_period_unit', sa.Enum('HOUR', 'DAY', 'WEEK', 'MONTH', name='rentalperiodunit'), nullable=True, comment='Rental period unit'),
    sa.Column('current_rental_status', sa.Enum('RENTAL_INPROGRESS', 'RENTAL_COMPLETED', 'RENTAL_LATE', 'RENTAL_EXTENDED', 'RENTAL_PARTIAL_RETURN', 'RENTAL_LATE_PARTIAL_RETURN', name='rentalstatus'), nullable=True, comment='Current rental status for this item'),
    sa.Column('daily_rate', sa.Numeric(precision=10, scale=2), nullable=True, comment='Daily rental rate'),
    sa.Column('location_id', sa.UUID(), nullable=True, comment='Fulfillment location UUID'),
    sa.Column('warehouse_location', sa.String(length=100), nullable=True, comment='Specific warehouse location'),
    sa.Column('status', sa.String(length=20), nullable=False, comment='Line item status'),
    sa.Column('fulfillment_status', sa.String(length=20), nullable=False, comment='Fulfillment status'),
    sa.Column('returned_quantity', sa.Numeric(precision=10, scale=2), nullable=False, comment='Returned quantity'),
    sa.Column('return_date', sa.Date(), nullable=True, comment='Return date'),
    sa.Column('notes', sa.Text(), nullable=True, comment='Additional notes'),
    sa.Column('return_condition', sa.String(length=1), nullable=True, comment='Return condition (A-D)'),
    sa.Column('return_to_stock', sa.Boolean(), nullable=True, comment='Whether to return to stock'),
    sa.Column('inspection_status', sa.String(length=20), nullable=True, comment='Inspection status for returns'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.CheckConstraint('discount_percent >= 0 AND discount_percent <= 100', name='check_valid_discount_percent'),
    sa.CheckConstraint('quantity > 0', name='check_positive_quantity'),
    sa.CheckConstraint('returned_quantity <= quantity', name='check_returned_not_exceed_quantity'),
    sa.CheckConstraint('returned_quantity >= 0', name='check_non_negative_returned'),
    sa.CheckConstraint('tax_rate >= 0', name='check_non_negative_tax_rate'),
    sa.CheckConstraint('unit_price >= 0', name='check_non_negative_price'),
    sa.ForeignKeyConstraint(['item_id'], ['items.id'], name='fk_transaction_line_item'),
    sa.ForeignKeyConstraint(['location_id'], ['locations.id'], name='fk_transaction_line_location'),
    sa.ForeignKeyConstraint(['transaction_header_id'], ['transaction_headers.id'], name='fk_transaction_line_header'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('transaction_header_id', 'line_number', name='uq_transaction_line_number')
    )
    op.create_index('idx_fulfillment_status', 'transaction_lines', ['fulfillment_status'], unique=False)
    op.create_index('idx_inventory_unit_id', 'transaction_lines', ['inventory_unit_id'], unique=False)
    op.create_index('idx_item_id', 'transaction_lines', ['item_id'], unique=False)
    op.create_index('idx_line_number', 'transaction_lines', ['transaction_header_id', 'line_number'], unique=False)
    op.create_index('idx_rental_dates', 'transaction_lines', ['rental_start_date', 'rental_end_date'], unique=False)
    op.create_index('idx_rental_status', 'transaction_lines', ['current_rental_status'], unique=False)
    op.create_index('idx_sku', 'transaction_lines', ['sku'], unique=False)
    op.create_index('idx_status', 'transaction_lines', ['status'], unique=False)
    op.create_index('idx_transaction_header_id', 'transaction_lines', ['transaction_header_id'], unique=False)
    op.create_index(op.f('ix_transaction_lines_is_active'), 'transaction_lines', ['is_active'], unique=False)
    op.create_table('transaction_metadata',
    sa.Column('transaction_id', sa.UUID(), nullable=False, comment='Transaction ID this metadata belongs to'),
    sa.Column('metadata_type', sa.String(length=50), nullable=False, comment='Type of metadata (e.g., RETURN_SALE_RETURN)'),
    sa.Column('metadata_content', postgresql.JSONB(astext_type=sa.Text()), nullable=False, comment='JSON content with type-specific data'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.ForeignKeyConstraint(['transaction_id'], ['transaction_headers.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_transaction_metadata_content', 'transaction_metadata', ['metadata_content'], unique=False, postgresql_using='gin')
    op.create_index('idx_transaction_metadata_txn_id', 'transaction_metadata', ['transaction_id'], unique=False)
    op.create_index('idx_transaction_metadata_type', 'transaction_metadata', ['metadata_type'], unique=False)
    op.create_index(op.f('ix_transaction_metadata_is_active'), 'transaction_metadata', ['is_active'], unique=False)
    op.create_table('rental_return_events',
    sa.Column('rental_lifecycle_id', sa.UUID(), nullable=False, comment='Associated rental lifecycle'),
    sa.Column('event_type', sa.String(length=20), nullable=False, comment='Type of return event'),
    sa.Column('event_date', sa.Date(), nullable=False, comment='Date of the event'),
    sa.Column('processed_by', sa.UUID(), nullable=True, comment='User who processed this event'),
    sa.Column('processed_at', sa.DateTime(timezone=True), nullable=False, comment='When the event was processed'),
    sa.Column('items_returned', sa.JSON(), nullable=True, comment='JSON array of returned items with quantities and conditions'),
    sa.Column('total_quantity_returned', sa.Numeric(precision=10, scale=2), nullable=False, comment='Total quantity returned in this event'),
    sa.Column('late_fees_charged', sa.Numeric(precision=15, scale=2), nullable=False, comment='Late fees charged in this event'),
    sa.Column('damage_fees_charged', sa.Numeric(precision=15, scale=2), nullable=False, comment='Damage fees charged in this event'),
    sa.Column('other_fees_charged', sa.Numeric(precision=15, scale=2), nullable=False, comment='Other fees charged in this event'),
    sa.Column('payment_collected', sa.Numeric(precision=15, scale=2), nullable=False, comment='Payment collected during this event'),
    sa.Column('refund_issued', sa.Numeric(precision=15, scale=2), nullable=False, comment='Refund issued during this event'),
    sa.Column('new_return_date', sa.Date(), nullable=True, comment='New return date for extensions'),
    sa.Column('extension_reason', sa.String(length=200), nullable=True, comment='Reason for extension'),
    sa.Column('notes', sa.Text(), nullable=True, comment='Notes about this event'),
    sa.Column('receipt_number', sa.String(length=50), nullable=True, comment='Receipt number for payments/refunds'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.ForeignKeyConstraint(['rental_lifecycle_id'], ['rental_lifecycles.id'], name='fk_rental_return_event_lifecycle'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_return_event_date', 'rental_return_events', ['event_date'], unique=False)
    op.create_index('idx_return_event_lifecycle', 'rental_return_events', ['rental_lifecycle_id'], unique=False)
    op.create_index('idx_return_event_processed', 'rental_return_events', ['processed_at'], unique=False)
    op.create_index('idx_return_event_type', 'rental_return_events', ['event_type'], unique=False)
    op.create_index(op.f('ix_rental_return_events_is_active'), 'rental_return_events', ['is_active'], unique=False)
    op.create_table('rental_status_logs',
    sa.Column('transaction_id', sa.UUID(), nullable=False, comment='Transaction being tracked'),
    sa.Column('transaction_line_id', sa.UUID(), nullable=True, comment='Specific line item (null for header-level changes)'),
    sa.Column('rental_lifecycle_id', sa.UUID(), nullable=True, comment='Associated rental lifecycle'),
    sa.Column('old_status', sa.String(length=30), nullable=True, comment='Previous status (null for initial status)'),
    sa.Column('new_status', sa.String(length=30), nullable=False, comment='New status after change'),
    sa.Column('change_reason', sa.String(length=30), nullable=False, comment='Reason for the status change'),
    sa.Column('change_trigger', sa.String(length=50), nullable=True, comment='What triggered the change'),
    sa.Column('changed_by', sa.UUID(), nullable=True, comment='User who initiated the change'),
    sa.Column('changed_at', sa.DateTime(timezone=True), nullable=False, comment='When the change occurred'),
    sa.Column('notes', sa.Text(), nullable=True, comment='Additional notes about the status change'),
    sa.Column('status_metadata', sa.JSON(), nullable=True, comment='Additional context data'),
    sa.Column('system_generated', sa.Boolean(), nullable=False, comment='Whether this change was system-generated'),
    sa.Column('batch_id', sa.String(length=50), nullable=True, comment='Batch ID for scheduled updates'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.ForeignKeyConstraint(['rental_lifecycle_id'], ['rental_lifecycles.id'], name='fk_status_log_lifecycle'),
    sa.ForeignKeyConstraint(['transaction_id'], ['transaction_headers.id'], name='fk_status_log_transaction'),
    sa.ForeignKeyConstraint(['transaction_line_id'], ['transaction_lines.id'], name='fk_status_log_line'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_status_log_batch', 'rental_status_logs', ['batch_id'], unique=False)
    op.create_index('idx_status_log_changed_at', 'rental_status_logs', ['changed_at'], unique=False)
    op.create_index('idx_status_log_line', 'rental_status_logs', ['transaction_line_id'], unique=False)
    op.create_index('idx_status_log_reason', 'rental_status_logs', ['change_reason'], unique=False)
    op.create_index('idx_status_log_system', 'rental_status_logs', ['system_generated'], unique=False)
    op.create_index('idx_status_log_transaction', 'rental_status_logs', ['transaction_id'], unique=False)
    op.create_index(op.f('ix_rental_status_logs_is_active'), 'rental_status_logs', ['is_active'], unique=False)
    op.create_table('stock_movements',
    sa.Column('stock_level_id', sa.UUID(), nullable=False, comment='Reference to the stock level being modified'),
    sa.Column('item_id', sa.UUID(), nullable=False, comment='Item being moved'),
    sa.Column('location_id', sa.UUID(), nullable=False, comment='Location where movement occurred'),
    sa.Column('transaction_header_id', sa.UUID(), nullable=True, comment='Optional link to transaction header'),
    sa.Column('transaction_line_id', sa.UUID(), nullable=True, comment='Optional link to specific transaction line'),
    sa.Column('movement_type', sa.Enum('PURCHASE', 'PURCHASE_RETURN', 'SALE', 'SALE_RETURN', 'RENTAL_OUT', 'RENTAL_RETURN', 'RENTAL_RETURN_DAMAGED', 'RENTAL_RETURN_MIXED', 'RENTAL_EXTENSION', 'DAMAGE_ASSESSMENT', 'SENT_FOR_REPAIR', 'REPAIR_COMPLETED', 'WRITE_OFF', 'ADJUSTMENT_POSITIVE', 'ADJUSTMENT_NEGATIVE', 'SYSTEM_CORRECTION', 'TRANSFER_IN', 'TRANSFER_OUT', 'RESERVATION_CREATED', 'RESERVATION_CANCELLED', 'RESERVATION_EXTENDED', 'DAMAGE_LOSS', 'THEFT_LOSS', 'EXPIRY_LOSS', name='stockmovementtype', native_enum=False), nullable=False, comment='Type of stock movement'),
    sa.Column('quantity_change', sa.Numeric(precision=10, scale=2), nullable=False, comment='Quantity changed (positive for increase, negative for decrease)'),
    sa.Column('quantity_before', sa.Numeric(precision=10, scale=2), nullable=False, comment='Stock quantity before movement'),
    sa.Column('quantity_after', sa.Numeric(precision=10, scale=2), nullable=False, comment='Stock quantity after movement'),
    sa.Column('unit_cost', sa.Numeric(precision=10, scale=2), nullable=True, comment='Cost per unit for this movement (for valuation)'),
    sa.Column('total_cost', sa.Numeric(precision=12, scale=2), nullable=True, comment='Total cost of this movement'),
    sa.Column('reference_number', sa.String(length=100), nullable=True, comment='External reference number (PO, Invoice, etc.)'),
    sa.Column('reason', sa.String(length=500), nullable=True, comment='Reason for movement (especially for adjustments)'),
    sa.Column('notes', sa.Text(), nullable=True, comment='Additional notes about this movement'),
    sa.Column('performed_by_id', sa.UUID(), nullable=True, comment='User who performed this movement'),
    sa.Column('approved_by_id', sa.UUID(), nullable=True, comment='User who approved this movement (for adjustments)'),
    sa.Column('movement_date', sa.DateTime(timezone=True), nullable=False, comment='When the movement occurred'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.CheckConstraint('abs(quantity_before + quantity_change - quantity_after) < 0.01', name='check_quantity_math'),
    sa.CheckConstraint('quantity_after >= 0', name='check_quantity_after_non_negative'),
    sa.CheckConstraint('quantity_before >= 0', name='check_quantity_before_non_negative'),
    sa.ForeignKeyConstraint(['approved_by_id'], ['users.id'], name='fk_stock_movement_approved_by'),
    sa.ForeignKeyConstraint(['item_id'], ['items.id'], name='fk_stock_movement_item'),
    sa.ForeignKeyConstraint(['location_id'], ['locations.id'], name='fk_stock_movement_location'),
    sa.ForeignKeyConstraint(['performed_by_id'], ['users.id'], name='fk_stock_movement_performed_by'),
    sa.ForeignKeyConstraint(['stock_level_id'], ['stock_levels.id'], name='fk_stock_movement_stock_level'),
    sa.ForeignKeyConstraint(['transaction_header_id'], ['transaction_headers.id'], name='fk_stock_movement_transaction_header'),
    sa.ForeignKeyConstraint(['transaction_line_id'], ['transaction_lines.id'], name='fk_stock_movement_transaction_line'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_stock_movement_date', 'stock_movements', ['movement_date'], unique=False)
    op.create_index('idx_stock_movement_item', 'stock_movements', ['item_id'], unique=False)
    op.create_index('idx_stock_movement_item_date', 'stock_movements', ['item_id', 'movement_date'], unique=False)
    op.create_index('idx_stock_movement_location', 'stock_movements', ['location_id'], unique=False)
    op.create_index('idx_stock_movement_location_date', 'stock_movements', ['location_id', 'movement_date'], unique=False)
    op.create_index('idx_stock_movement_stock_level', 'stock_movements', ['stock_level_id'], unique=False)
    op.create_index('idx_stock_movement_transaction', 'stock_movements', ['transaction_header_id', 'transaction_line_id'], unique=False)
    op.create_index('idx_stock_movement_type', 'stock_movements', ['movement_type'], unique=False)
    op.create_index(op.f('ix_stock_movements_is_active'), 'stock_movements', ['is_active'], unique=False)
    op.create_table('transaction_inspections',
    sa.Column('transaction_line_id', sa.UUID(), nullable=False, comment='Transaction line being inspected'),
    sa.Column('inspection_date', sa.DateTime(timezone=True), nullable=False, comment='Date and time of inspection'),
    sa.Column('inspector_id', sa.UUID(), nullable=True, comment='User who performed the inspection'),
    sa.Column('status', sa.Enum('PENDING', 'IN_PROGRESS', 'COMPLETED', 'CANCELLED', name='inspectionstatus'), nullable=False, comment='Current status of inspection'),
    sa.Column('condition_rating', sa.Enum('A', 'B', 'C', 'D', 'E', name='conditionrating'), nullable=False, comment='Overall condition rating'),
    sa.Column('damage_type', sa.Enum('NONE', 'COSMETIC', 'FUNCTIONAL', 'STRUCTURAL', 'WATER_DAMAGE', 'PHYSICAL_DAMAGE', 'MISSING_PARTS', 'CONTAMINATION', 'OTHER', name='damagetype'), nullable=False, comment='Primary type of damage found'),
    sa.Column('damage_description', sa.Text(), nullable=True, comment='Detailed description of damage'),
    sa.Column('repair_cost_estimate', sa.Numeric(precision=10, scale=2), nullable=False, comment='Estimated cost to repair'),
    sa.Column('actual_repair_cost', sa.Numeric(precision=10, scale=2), nullable=True, comment='Actual cost incurred for repair'),
    sa.Column('depreciation_amount', sa.Numeric(precision=10, scale=2), nullable=False, comment='Value depreciation due to damage'),
    sa.Column('refund_adjustment', sa.Numeric(precision=10, scale=2), nullable=False, comment='Adjustment to refund amount based on condition'),
    sa.Column('disposition', sa.Enum('RETURN_TO_STOCK', 'SEND_TO_REPAIR', 'WRITE_OFF', 'RETURN_TO_VENDOR', 'QUARANTINE', 'DISPOSE', name='itemdisposition'), nullable=False, comment='What to do with the item'),
    sa.Column('return_to_stock', sa.Boolean(), nullable=False, comment='Whether item can be returned to sellable stock'),
    sa.Column('quarantine_required', sa.Boolean(), nullable=False, comment='Whether item needs quarantine'),
    sa.Column('quarantine_days', sa.Integer(), nullable=True, comment='Number of days in quarantine'),
    sa.Column('photos_taken', sa.Boolean(), nullable=False, comment='Whether photos were taken for documentation'),
    sa.Column('photo_urls', sa.Text(), nullable=True, comment='JSON array of photo URLs'),
    sa.Column('inspection_checklist', sa.Text(), nullable=True, comment='JSON checklist of inspection points'),
    sa.Column('inspection_notes', sa.Text(), nullable=True, comment='Additional inspection notes'),
    sa.Column('secondary_inspector_id', sa.UUID(), nullable=True, comment='User who performed secondary inspection'),
    sa.Column('secondary_inspection_date', sa.DateTime(timezone=True), nullable=True, comment='Date of secondary inspection'),
    sa.Column('secondary_inspection_notes', sa.Text(), nullable=True, comment='Notes from secondary inspection'),
    sa.Column('approved', sa.Boolean(), nullable=True, comment='Whether disposition is approved'),
    sa.Column('approved_by_id', sa.UUID(), nullable=True, comment='User who approved the disposition'),
    sa.Column('approval_date', sa.DateTime(timezone=True), nullable=True, comment='Date of approval'),
    sa.Column('approval_notes', sa.Text(), nullable=True, comment='Notes from approver'),
    sa.Column('vendor_rma_number', sa.String(length=100), nullable=True, comment='Vendor Return Merchandise Authorization number'),
    sa.Column('vendor_return_shipped_date', sa.DateTime(timezone=True), nullable=True, comment='Date item was shipped back to vendor'),
    sa.Column('vendor_credit_received', sa.Numeric(precision=10, scale=2), nullable=True, comment='Credit received from vendor'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.CheckConstraint('depreciation_amount >= 0', name='check_non_negative_depreciation'),
    sa.CheckConstraint('refund_adjustment >= 0', name='check_non_negative_refund_adjustment'),
    sa.CheckConstraint('repair_cost_estimate >= 0', name='check_non_negative_repair_estimate'),
    sa.ForeignKeyConstraint(['approved_by_id'], ['users.id'], name='fk_inspection_approved_by'),
    sa.ForeignKeyConstraint(['inspector_id'], ['users.id'], name='fk_inspection_inspector'),
    sa.ForeignKeyConstraint(['secondary_inspector_id'], ['users.id'], name='fk_inspection_secondary_inspector'),
    sa.ForeignKeyConstraint(['transaction_line_id'], ['transaction_lines.id'], name='fk_inspection_transaction_line'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_condition_rating', 'transaction_inspections', ['condition_rating'], unique=False)
    op.create_index('idx_disposition', 'transaction_inspections', ['disposition'], unique=False)
    op.create_index('idx_inspection_date', 'transaction_inspections', ['inspection_date'], unique=False)
    op.create_index('idx_inspection_status', 'transaction_inspections', ['status'], unique=False)
    op.create_index('idx_inspection_transaction_line', 'transaction_inspections', ['transaction_line_id'], unique=False)
    op.create_index('idx_inspector', 'transaction_inspections', ['inspector_id'], unique=False)
    op.create_index(op.f('ix_transaction_inspections_is_active'), 'transaction_inspections', ['is_active'], unique=False)
    op.create_table('rental_item_inspections',
    sa.Column('return_event_id', sa.UUID(), nullable=False, comment='Associated return event'),
    sa.Column('transaction_line_id', sa.UUID(), nullable=False, comment='Transaction line being inspected'),
    sa.Column('quantity_inspected', sa.Numeric(precision=10, scale=2), nullable=False, comment='Quantity of this item inspected'),
    sa.Column('condition', sa.String(length=20), nullable=False, comment='Overall condition assessment'),
    sa.Column('inspected_by', sa.UUID(), nullable=True, comment='User who performed inspection'),
    sa.Column('inspected_at', sa.DateTime(timezone=True), nullable=False, comment='Inspection timestamp'),
    sa.Column('has_damage', sa.Boolean(), nullable=False, comment='Whether item has damage'),
    sa.Column('damage_description', sa.Text(), nullable=True, comment='Description of any damage'),
    sa.Column('damage_photos', sa.JSON(), nullable=True, comment='JSON array of damage photo URLs'),
    sa.Column('damage_fee_assessed', sa.Numeric(precision=15, scale=2), nullable=False, comment='Damage fee assessed for this item'),
    sa.Column('cleaning_fee_assessed', sa.Numeric(precision=15, scale=2), nullable=False, comment='Cleaning fee assessed for this item'),
    sa.Column('replacement_required', sa.Boolean(), nullable=False, comment='Whether item needs replacement'),
    sa.Column('replacement_cost', sa.Numeric(precision=15, scale=2), nullable=True, comment='Cost of replacement if required'),
    sa.Column('return_to_stock', sa.Boolean(), nullable=False, comment='Whether item can be returned to stock'),
    sa.Column('stock_location', sa.String(length=100), nullable=True, comment='Where item was returned to stock'),
    sa.Column('inspection_notes', sa.Text(), nullable=True, comment='Detailed inspection notes'),
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False, comment='UUID primary key generated by PostgreSQL'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('updated_by', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_by', sa.String(length=255), nullable=True),
    sa.ForeignKeyConstraint(['return_event_id'], ['rental_return_events.id'], name='fk_inspection_return_event'),
    sa.ForeignKeyConstraint(['transaction_line_id'], ['transaction_lines.id'], name='fk_inspection_transaction_line'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_inspection_condition', 'rental_item_inspections', ['condition'], unique=False)
    op.create_index('idx_inspection_damage', 'rental_item_inspections', ['has_damage'], unique=False)
    op.create_index('idx_inspection_return_event', 'rental_item_inspections', ['return_event_id'], unique=False)
    op.create_index('idx_rental_inspection_transaction_line', 'rental_item_inspections', ['transaction_line_id'], unique=False)
    op.create_index(op.f('ix_rental_item_inspections_is_active'), 'rental_item_inspections', ['is_active'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_rental_item_inspections_is_active'), table_name='rental_item_inspections')
    op.drop_index('idx_rental_inspection_transaction_line', table_name='rental_item_inspections')
    op.drop_index('idx_inspection_return_event', table_name='rental_item_inspections')
    op.drop_index('idx_inspection_damage', table_name='rental_item_inspections')
    op.drop_index('idx_inspection_condition', table_name='rental_item_inspections')
    op.drop_table('rental_item_inspections')
    op.drop_index(op.f('ix_transaction_inspections_is_active'), table_name='transaction_inspections')
    op.drop_index('idx_inspector', table_name='transaction_inspections')
    op.drop_index('idx_inspection_transaction_line', table_name='transaction_inspections')
    op.drop_index('idx_inspection_status', table_name='transaction_inspections')
    op.drop_index('idx_inspection_date', table_name='transaction_inspections')
    op.drop_index('idx_disposition', table_name='transaction_inspections')
    op.drop_index('idx_condition_rating', table_name='transaction_inspections')
    op.drop_table('transaction_inspections')
    op.drop_index(op.f('ix_stock_movements_is_active'), table_name='stock_movements')
    op.drop_index('idx_stock_movement_type', table_name='stock_movements')
    op.drop_index('idx_stock_movement_transaction', table_name='stock_movements')
    op.drop_index('idx_stock_movement_stock_level', table_name='stock_movements')
    op.drop_index('idx_stock_movement_location_date', table_name='stock_movements')
    op.drop_index('idx_stock_movement_location', table_name='stock_movements')
    op.drop_index('idx_stock_movement_item_date', table_name='stock_movements')
    op.drop_index('idx_stock_movement_item', table_name='stock_movements')
    op.drop_index('idx_stock_movement_date', table_name='stock_movements')
    op.drop_table('stock_movements')
    op.drop_index(op.f('ix_rental_status_logs_is_active'), table_name='rental_status_logs')
    op.drop_index('idx_status_log_transaction', table_name='rental_status_logs')
    op.drop_index('idx_status_log_system', table_name='rental_status_logs')
    op.drop_index('idx_status_log_reason', table_name='rental_status_logs')
    op.drop_index('idx_status_log_line', table_name='rental_status_logs')
    op.drop_index('idx_status_log_changed_at', table_name='rental_status_logs')
    op.drop_index('idx_status_log_batch', table_name='rental_status_logs')
    op.drop_table('rental_status_logs')
    op.drop_index(op.f('ix_rental_return_events_is_active'), table_name='rental_return_events')
    op.drop_index('idx_return_event_type', table_name='rental_return_events')
    op.drop_index('idx_return_event_processed', table_name='rental_return_events')
    op.drop_index('idx_return_event_lifecycle', table_name='rental_return_events')
    op.drop_index('idx_return_event_date', table_name='rental_return_events')
    op.drop_table('rental_return_events')
    op.drop_index(op.f('ix_transaction_metadata_is_active'), table_name='transaction_metadata')
    op.drop_index('idx_transaction_metadata_type', table_name='transaction_metadata')
    op.drop_index('idx_transaction_metadata_txn_id', table_name='transaction_metadata')
    op.drop_index('idx_transaction_metadata_content', table_name='transaction_metadata', postgresql_using='gin')
    op.drop_table('transaction_metadata')
    op.drop_index(op.f('ix_transaction_lines_is_active'), table_name='transaction_lines')
    op.drop_index('idx_transaction_header_id', table_name='transaction_lines')
    op.drop_index('idx_status', table_name='transaction_lines')
    op.drop_index('idx_sku', table_name='transaction_lines')
    op.drop_index('idx_rental_status', table_name='transaction_lines')
    op.drop_index('idx_rental_dates', table_name='transaction_lines')
    op.drop_index('idx_line_number', table_name='transaction_lines')
    op.drop_index('idx_item_id', table_name='transaction_lines')
    op.drop_index('idx_inventory_unit_id', table_name='transaction_lines')
    op.drop_index('idx_fulfillment_status', table_name='transaction_lines')
    op.drop_table('transaction_lines')
    op.drop_index(op.f('ix_transaction_events_is_active'), table_name='transaction_events')
    op.drop_index('idx_transaction_events_user_id', table_name='transaction_events')
    op.drop_index('idx_transaction_events_tx_type_time', table_name='transaction_events')
    op.drop_index('idx_transaction_events_transaction_id', table_name='transaction_events')
    op.drop_index('idx_transaction_events_timestamp', table_name='transaction_events')
    op.drop_index('idx_transaction_events_status', table_name='transaction_events')
    op.drop_index('idx_transaction_events_operation', table_name='transaction_events')
    op.drop_index('idx_transaction_events_event_type', table_name='transaction_events')
    op.drop_index('idx_transaction_events_correlation', table_name='transaction_events')
    op.drop_index('idx_transaction_events_category_status', table_name='transaction_events')
    op.drop_index('idx_transaction_events_category', table_name='transaction_events')
    op.drop_table('transaction_events')
    op.drop_index(op.f('ix_stock_levels_is_active'), table_name='stock_levels')
    op.drop_index('idx_stock_level_status', table_name='stock_levels')
    op.drop_index('idx_stock_level_low_stock', table_name='stock_levels')
    op.drop_index('idx_stock_level_location', table_name='stock_levels')
    op.drop_index('idx_stock_level_item', table_name='stock_levels')
    op.drop_index('idx_stock_level_available', table_name='stock_levels')
    op.drop_table('stock_levels')
    op.drop_index(op.f('ix_rental_lifecycles_is_active'), table_name='rental_lifecycles')
    op.drop_index('idx_lifecycle_transaction', table_name='rental_lifecycles')
    op.drop_index('idx_lifecycle_status', table_name='rental_lifecycles')
    op.drop_index('idx_lifecycle_expected_return', table_name='rental_lifecycles')
    op.drop_table('rental_lifecycles')
    op.drop_index(op.f('ix_inventory_units_sku'), table_name='inventory_units')
    op.drop_index(op.f('ix_inventory_units_serial_number'), table_name='inventory_units')
    op.drop_index(op.f('ix_inventory_units_is_active'), table_name='inventory_units')
    op.drop_index(op.f('ix_inventory_units_batch_code'), table_name='inventory_units')
    op.drop_index(op.f('ix_inventory_units_barcode'), table_name='inventory_units')
    op.drop_index('idx_inventory_unit_status', table_name='inventory_units')
    op.drop_index('idx_inventory_unit_rental_blocked', table_name='inventory_units')
    op.drop_index('idx_inventory_unit_location', table_name='inventory_units')
    op.drop_index('idx_inventory_unit_item', table_name='inventory_units')
    op.drop_index('idx_inventory_unit_condition', table_name='inventory_units')
    op.drop_index('idx_inventory_unit_batch', table_name='inventory_units')
    op.drop_index('idx_inventory_unit_available', table_name='inventory_units')
    op.drop_table('inventory_units')
    op.drop_index(op.f('ix_transaction_headers_is_active'), table_name='transaction_headers')
    op.drop_index('idx_transaction_type', table_name='transaction_headers')
    op.drop_index('idx_transaction_status', table_name='transaction_headers')
    op.drop_index('idx_transaction_number', table_name='transaction_headers')
    op.drop_index('idx_transaction_date', table_name='transaction_headers')
    op.drop_index('idx_supplier_id', table_name='transaction_headers')
    op.drop_index('idx_reference_transaction', table_name='transaction_headers')
    op.drop_index('idx_pickup_date', table_name='transaction_headers')
    op.drop_index('idx_location_id', table_name='transaction_headers')
    op.drop_index('idx_delivery_date', table_name='transaction_headers')
    op.drop_index('idx_customer_id', table_name='transaction_headers')
    op.drop_table('transaction_headers')
    op.drop_index('idx_sku_sequence_next', table_name='sku_sequences')
    op.drop_index('idx_sku_sequence_category', table_name='sku_sequences')
    op.drop_index('idx_sku_sequence_brand', table_name='sku_sequences')
    op.drop_index('idx_sku_sequence_active', table_name='sku_sequences')
    op.drop_table('sku_sequences')
    op.drop_index(op.f('ix_items_unit_of_measurement_id'), table_name='items')
    op.drop_index(op.f('ix_items_status'), table_name='items')
    op.drop_index(op.f('ix_items_sku'), table_name='items')
    op.drop_index(op.f('ix_items_item_name'), table_name='items')
    op.drop_index(op.f('ix_items_is_salable'), table_name='items')
    op.drop_index(op.f('ix_items_is_rental_blocked'), table_name='items')
    op.drop_index(op.f('ix_items_is_rentable'), table_name='items')
    op.drop_index(op.f('ix_items_is_active'), table_name='items')
    op.drop_index(op.f('ix_items_category_id'), table_name='items')
    op.drop_index(op.f('ix_items_brand_id'), table_name='items')
    op.drop_index('idx_item_unit_active', table_name='items')
    op.drop_index('idx_item_status_active', table_name='items')
    op.drop_index('idx_item_sku_active', table_name='items')
    op.drop_index('idx_item_search_text', table_name='items')
    op.drop_index('idx_item_sale_price', table_name='items')
    op.drop_index('idx_item_salable_active', table_name='items')
    op.drop_index('idx_item_rental_rate', table_name='items')
    op.drop_index('idx_item_rental_blocked', table_name='items')
    op.drop_index('idx_item_rentable_active', table_name='items')
    op.drop_index('idx_item_name_active', table_name='items')
    op.drop_index('idx_item_category_rentable', table_name='items')
    op.drop_index('idx_item_category_active', table_name='items')
    op.drop_index('idx_item_brand_salable', table_name='items')
    op.drop_index('idx_item_brand_active', table_name='items')
    op.drop_table('items')
    op.drop_index(op.f('ix_users_username'), table_name='users')
    op.drop_index(op.f('ix_users_email'), table_name='users')
    op.drop_table('users')
    op.drop_index(op.f('ix_unit_of_measurements_name'), table_name='unit_of_measurements')
    op.drop_index(op.f('ix_unit_of_measurements_is_active'), table_name='unit_of_measurements')
    op.drop_index(op.f('ix_unit_of_measurements_code'), table_name='unit_of_measurements')
    op.drop_index('idx_uom_name_active', table_name='unit_of_measurements')
    op.drop_index('idx_uom_created_at', table_name='unit_of_measurements')
    op.drop_index('idx_uom_code_active', table_name='unit_of_measurements')
    op.drop_table('unit_of_measurements')
    op.drop_index(op.f('ix_suppliers_supplier_code'), table_name='suppliers')
    op.drop_index(op.f('ix_suppliers_is_active'), table_name='suppliers')
    op.drop_index(op.f('ix_suppliers_email'), table_name='suppliers')
    op.drop_index(op.f('ix_suppliers_company_name'), table_name='suppliers')
    op.drop_index('idx_supplier_type', table_name='suppliers')
    op.drop_index('idx_supplier_tier', table_name='suppliers')
    op.drop_index('idx_supplier_status', table_name='suppliers')
    op.drop_index('idx_supplier_ratings', table_name='suppliers')
    op.drop_index('idx_supplier_payment_terms', table_name='suppliers')
    op.drop_index('idx_supplier_last_order', table_name='suppliers')
    op.drop_index('idx_supplier_email', table_name='suppliers')
    op.drop_index('idx_supplier_contract_dates', table_name='suppliers')
    op.drop_index('idx_supplier_company_name', table_name='suppliers')
    op.drop_index('idx_supplier_code', table_name='suppliers')
    op.drop_table('suppliers')
    op.drop_index(op.f('ix_locations_state'), table_name='locations')
    op.drop_index(op.f('ix_locations_parent_location_id'), table_name='locations')
    op.drop_index(op.f('ix_locations_location_type'), table_name='locations')
    op.drop_index(op.f('ix_locations_location_name'), table_name='locations')
    op.drop_index(op.f('ix_locations_location_code'), table_name='locations')
    op.drop_index(op.f('ix_locations_is_active'), table_name='locations')
    op.drop_index(op.f('ix_locations_country'), table_name='locations')
    op.drop_index(op.f('ix_locations_city'), table_name='locations')
    op.drop_index('idx_location_type', table_name='locations')
    op.drop_index('idx_location_parent', table_name='locations')
    op.drop_index('idx_location_name', table_name='locations')
    op.drop_index('idx_location_default', table_name='locations')
    op.drop_index('idx_location_country', table_name='locations')
    op.drop_index('idx_location_coordinates', table_name='locations')
    op.drop_index('idx_location_code', table_name='locations')
    op.drop_index('idx_location_city_state', table_name='locations')
    op.drop_index('idx_location_active', table_name='locations')
    op.drop_table('locations')
    op.drop_index(op.f('ix_customers_is_active'), table_name='customers')
    op.drop_index(op.f('ix_customers_email'), table_name='customers')
    op.drop_index(op.f('ix_customers_customer_code'), table_name='customers')
    op.drop_index('idx_customer_type_status', table_name='customers')
    op.drop_index('idx_customer_tier', table_name='customers')
    op.drop_index('idx_customer_location', table_name='customers')
    op.drop_index('idx_customer_email', table_name='customers')
    op.drop_index('idx_customer_code', table_name='customers')
    op.drop_index('idx_customer_blacklist', table_name='customers')
    op.drop_table('customers')
    op.drop_index(op.f('ix_contact_persons_is_active'), table_name='contact_persons')
    op.drop_index('idx_contact_person_primary', table_name='contact_persons')
    op.drop_index('idx_contact_person_phone', table_name='contact_persons')
    op.drop_index('idx_contact_person_mobile', table_name='contact_persons')
    op.drop_index('idx_contact_person_location', table_name='contact_persons')
    op.drop_index('idx_contact_person_full_name', table_name='contact_persons')
    op.drop_index('idx_contact_person_email', table_name='contact_persons')
    op.drop_index('idx_contact_person_company', table_name='contact_persons')
    op.drop_table('contact_persons')
    op.drop_index(op.f('ix_companies_registration_number'), table_name='companies')
    op.drop_index(op.f('ix_companies_is_active'), table_name='companies')
    op.drop_index(op.f('ix_companies_gst_no'), table_name='companies')
    op.drop_index(op.f('ix_companies_company_name'), table_name='companies')
    op.drop_index('idx_company_name_active', table_name='companies')
    op.drop_table('companies')
    op.drop_index('uk_category_name_parent', table_name='categories')
    op.drop_index(op.f('ix_categories_is_active'), table_name='categories')
    op.drop_index(op.f('ix_categories_category_path'), table_name='categories')
    op.drop_index(op.f('ix_categories_category_code'), table_name='categories')
    op.drop_index('idx_category_path', table_name='categories')
    op.drop_index('idx_category_parent_order', table_name='categories')
    op.drop_index('idx_category_parent', table_name='categories')
    op.drop_index('idx_category_level', table_name='categories')
    op.drop_index('idx_category_display_order', table_name='categories')
    op.drop_index('idx_category_active_leaf', table_name='categories')
    op.drop_table('categories')
    op.drop_index(op.f('ix_brands_name'), table_name='brands')
    op.drop_index(op.f('ix_brands_is_active'), table_name='brands')
    op.drop_index(op.f('ix_brands_code'), table_name='brands')
    op.drop_index('idx_brand_name_active', table_name='brands')
    op.drop_index('idx_brand_code_active', table_name='brands')
    op.drop_table('brands')
    # ### end Alembic commands ###